<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BPFAM â€” VIDEO</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="color-scheme" content="dark" />
</head>
<body>
  <!-- TITOLONE STILE BPFAM -->
  <header class="topbar">
    <h1 class="bpfam-title">ðŸŽ¥ BPFAM â€” VIDEO</h1>
  </header>

  <!-- GRIGLIA VIDEO -->
  <main id="gallery" class="grid"></main>

  <!-- TEMPLATE CARD VIDEO (solo player, nessun testo/bottone) -->
  <template id="video-card">
    <article class="card led">
      <div class="ratio">
        <video preload="metadata" playsinline controls></video>
      </div>
    </article>
  </template>

  <script>
    // ===== CONFIG: dove leggere i video =====
    const OWNER  = "bpfam";
    const REPO   = "Video-bpfam";
    const FOLDER = "videos";
    const API_URL = `https://api.github.com/repos/${OWNER}/${REPO}/contents/${FOLDER}`;

    async function loadVideos(){
      const gallery = document.getElementById("gallery");
      gallery.innerHTML = "";
      try{
        const res = await fetch(API_URL, { headers: { "Accept":"application/vnd.github+json" }});
        if(!res.ok) throw new Error("GitHub API " + res.status);
        const files = await res.json();
        const videoFiles = (Array.isArray(files) ? files : [])
          .filter(f => f.type === "file")
          .filter(f => /\.(mp4|mov|webm)$/i.test(f.name));

        const tpl = document.getElementById("video-card");
        videoFiles.forEach(file => {
          const node = tpl.content.cloneNode(true);
          const v = node.querySelector("video");
          // piccolo offset per avere subito anteprima frame
          v.src = file.download_url + "#t=0.1";
          gallery.appendChild(node);
        });

        if(videoFiles.length === 0){
          gallery.innerHTML = '<div class="empty">Nessun video nella cartella <code>/videos</code>.</div>';
        }
      }catch(e){
        console.error(e);
        gallery.innerHTML = '<div class="empty">Errore nel caricamento dei video.</div>';
      }
    }
    document.addEventListener("DOMContentLoaded", loadVideos);
  </script>
</body>
</html>